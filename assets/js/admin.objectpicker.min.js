var _CDN_OBJECTPICKER;_CDN_OBJECTPICKER=function(){var e=this;return e.activePicker=null,e.__construct=function(){return e.log("Constructing"),e.setupListeners(),e.initPickers(),e},e.setupListeners=function(){e.log("Setting up listeners"),$(document).on("click",".cdn-object-picker",function(){return e.openManager($(this)),!1}),$(document).on("click",".cdn-object-picker .cdn-object-picker__remove",function(){return e.resetPicker($(this).closest(".cdn-object-picker")),!1}),$(document).on("click",".cdn-object-picker .cdn-object-picker__preview-link",function(){return $.fn.fancybox?$.fancybox.open($(this).attr("href"),{helpers:{overlay:{locked:!1}}}):e.openManager($(this).closest(".cdn-object-picker")),!1})},e.initPickers=function(){e.log("Processing new CDN Pickers");var n=[];$(".cdn-object-picker:not(.cdn-object-picker--pending)").each(function(){$(this).addClass("cdn-object-picker--pending");var e=$(this).find(".cdn-object-picker__input").val();e?n.push(e):$(this).removeClass("cdn-object-picker--pending")}),n.length>0&&$.ajax({url:window.SITE_URL+"api/cdn/object",data:{ids:n.join(","),urls:"150x150-crop"}}).done(function(n){$(".cdn-object-picker--pending").each(function(){for(var c=parseInt($(this).find(".cdn-object-picker__input").val(),10),r=n.data.length-1;r>=0;r--)if(c===n.data[r].id)return void e.setPickerObject($(this),n.data[r])}),$(".cdn-object-picker--pending").removeClass("cdn-object-picker--pending")}).fail(function(n){var c;try{c=JSON.parse(n.responseText)}catch(r){c={status:500,error:"An unknown error occurred."}}e.warn(c.error)})},e.setPickerObject=function(n,c){if(e.resetPicker(n),e.log("Setting picker object"),n.find(".cdn-object-picker__input").val(c.id),c.isImg)n.addClass("cdn-object-picker--has-image"),n.find(".cdn-object-picker__preview-link").attr("href",c.url.src),n.find(".cdn-object-picker__preview").css({"background-image":"url("+c.url["CROP-150x150"]+")"});else{var r=e.getReadableFileSizeString(c.object.size);n.addClass("cdn-object-picker--has-file"),n.find(".cdn-object-picker__label").html(c.object.name+" ("+r+")")}},e.resetPicker=function(n){e.log("Resetting picker"),n.removeClass("cdn-object-picker--has-image cdn-object-picker--has-file"),n.find(".cdn-object-picker__preview-link").attr("href","#"),n.find(".cdn-object-picker__preview").removeAttr("style"),n.find(".cdn-object-picker__label").html(""),n.find(".cdn-object-picker__input").val("")},e.openManager=function(n){n.addClass("cdn-object-picker--pending"),e.log("Getting Manager URL"),$.ajax({url:window.SITE_URL+"api/cdn/manager/url",data:{bucket:n.data("bucket"),callback:["_CDN_OBJECTPICKER","receiveFromManager"]}}).done(function(c){$.fancybox?(e.log("Showing Manager"),e.activePicker=n,$("body").addClass("noscroll"),$.fancybox.open(c.data+"&isModal=1",{type:"iframe",width:"95%",height:"95%",iframe:{preload:!1},helpers:{overlay:{locked:!1}},beforeClose:function(){$("body").removeClass("noscroll")}})):e.warn("Fancybox not enabled.")}).fail(function(n){var c;try{c=JSON.parse(n.responseText)}catch(r){c={status:500,error:"An unknown error occurred."}}e.warn(c.error)}).always(function(){n.removeClass("cdn-object-picker--pending")})},e.receiveFromManager=function(n,c,r){e.log("Received data from manager"),e.activePicker.addClass("cdn-object-picker--pending"),$.ajax({url:window.SITE_URL+"api/cdn/object",data:{id:r,urls:"150x150-crop"}}).done(function(n){e.setPickerObject(e.activePicker,n.data)}).fail(function(n){var c;try{c=JSON.parse(n.responseText)}catch(r){c={status:500,error:"An unknown error occurred."}}e.warn(c.error)}).always(function(){e.activePicker.removeClass("cdn-object-picker--pending"),e.activePicker=null})},e.getReadableFileSizeString=function(e){var n=-1,c=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do e/=1024,n++;while(e>1024);return Math.max(e,.1).toFixed(1)+c[n]},e.log=function(e,n){"function"==typeof console.log&&(void 0!==n?console.log("CDN Object Picker:",e,n):console.log("CDN Object Picker:",e))},e.warn=function(e,n){"function"==typeof console.warn&&(void 0!==n?console.warn("CDN Object Picker:",e,n):console.warn("CDN Object Picker:",e))},e.__construct()}();
//# sourceMappingURL=admin.objectpicker.min.js.map
