!function(e){var n={};function c(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,c),t.l=!0,t.exports}c.m=e,c.c=n,c.d=function(e,n,r){c.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,n){if(1&n&&(e=c(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var t in e)c.d(r,t,function(n){return e[n]}.bind(null,t));return r},c.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(n,"a",n),n},c.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},c.p="",c(c.s=4)}({4:function(e,n,c){"use strict";c.r(n);c(5);(function(){var e=this;e.activePicker=null,e.objectCache=[],e.__construct=function(){return e.log("Constructing"),e.setupListeners(),e.initPickers(),e},e.setupListeners=function(){e.log("Setting up listeners"),$(document).on("click",".cdn-object-picker",function(){return e.openManager($(this)),$(this).trigger("opened"),!1}),$(document).on("click",".cdn-object-picker .cdn-object-picker__remove",function(){return $(this).closest(".cdn-object-picker").trigger("removed"),e.resetPicker($(this).closest(".cdn-object-picker")),!1}),$(document).on("click",".cdn-object-picker .cdn-object-picker__preview-link",function(){return $.fn.fancybox?($(this).closest(".cdn-object-picker").trigger("preview"),$.fancybox.open($(this).attr("href"),{helpers:{overlay:{locked:!1}}})):($(this).closest(".cdn-object-picker").trigger("opened"),e.openManager($(this).closest(".cdn-object-picker"))),!1}),$(document).on("refresh",".cdn-object-picker",function(){return e.refreshPicker($(this)),!1})},e.initPickers=function(){e.log("Processing new CDN Pickers"),e.refreshPicker($(".cdn-object-picker:not(.cdn-object-picker--pending)"))},e.refreshPicker=function(n){var c=[];n.each(function(){$(this).addClass("cdn-object-picker--pending");var e=$(this).find(".cdn-object-picker__input").val();e?c.push(e):$(this).removeClass("cdn-object-picker--pending")}),c.length>0&&$.ajax({url:window.SITE_URL+"api/cdn/object",data:{ids:c.join(","),urls:"150x150-crop"}}).done(function(c){n.each(function(){for(var n=parseInt($(this).find(".cdn-object-picker__input").val(),10),r=c.data.length-1;r>=0;r--)if(n===c.data[r].id)return void e.setPickerObject($(this),c.data[r])}),n.removeClass("cdn-object-picker--pending")}).fail(function(n){var c;try{c=JSON.parse(n.responseText)}catch(e){c={status:500,error:"An unknown error occurred."}}e.warn(c.error)})},e.setPickerObject=function(n,c){if(e.resetPicker(n),e.log("Setting picker object"),n.find(".cdn-object-picker__input").val(c.id),n.trigger("picked"),c.is_img)n.addClass("cdn-object-picker--has-image"),n.find(".cdn-object-picker__preview-link").attr("href",c.url.src),n.find(".cdn-object-picker__preview").css({"background-image":"url("+c.url["150x150-crop"]+")"});else{var r=e.getReadableFileSizeString(c.object.size.bytes);n.addClass("cdn-object-picker--has-file"),n.find(".cdn-object-picker__label").html(c.object.name+" ("+r+")").attr("title",c.object.name+" ("+r+")")}},e.resetPicker=function(n){e.log("Resetting picker"),n.removeClass("cdn-object-picker--has-image cdn-object-picker--has-file"),n.find(".cdn-object-picker__preview-link").attr("href","#"),n.find(".cdn-object-picker__preview").removeAttr("style"),n.find(".cdn-object-picker__label").html(""),n.find(".cdn-object-picker__input").val("")},e.openManager=function(n){if(n.data("readonly"))return!1;n.addClass("cdn-object-picker--pending"),e.log("Getting Manager URL"),$.ajax({url:window.SITE_URL+"api/cdn/manager/url",data:{bucket:n.data("bucket"),callback:["_CDN_OBJECTPICKER","receiveFromManager"]}}).done(function(c){$.fancybox?(e.log("Showing Manager"),e.activePicker=n,$("body").addClass("noscroll"),$.fancybox.open(c.data+"&isModal=1",{type:"iframe",width:"95%",height:"95%",iframe:{preload:!1},helpers:{overlay:{locked:!1}},beforeClose:function(){$("body").removeClass("noscroll")}})):e.warn("Fancybox not enabled.")}).fail(function(n){var c;try{c=JSON.parse(n.responseText)}catch(e){c={status:500,error:"An unknown error occurred."}}e.warn(c.error)}).always(function(){n.removeClass("cdn-object-picker--pending")})},e.receiveFromManager=function(n){e.log("Received data from manager"),e.activePicker.addClass("cdn-object-picker--pending");var c=e.getFromCache(n);c?(e.log("Using Cache"),e.setPickerObject(e.activePicker,c),e.activePicker.removeClass("cdn-object-picker--pending"),e.activePicker=null):(e.log("Requesting Object data"),$.ajax({url:window.SITE_URL+"api/cdn/object",data:{id:n,urls:"150x150-crop"}}).done(function(n){e.setObjectCache(n.data),e.setPickerObject(e.activePicker,n.data)}).fail(function(n){var c;try{c=JSON.parse(n.responseText)}catch(e){c={status:500,error:"An unknown error occurred."}}e.warn(c.error)}).always(function(){e.activePicker.removeClass("cdn-object-picker--pending"),e.activePicker=null}))},e.getReadableFileSizeString=function(e){var n=-1;do{e/=1024,n++}while(e>1024);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][n]},e.getFromCache=function(n){for(var c=e.objectCache.length-1;c>=0;c--)if(e.objectCache[c].id===n)return e.objectCache[c];return null},e.setObjectCache=function(n){e.objectCache.push(n)},e.log=function(e,n){"function"==typeof console.log&&(void 0!==n?console.log("CDN Object Picker:",e,n):console.log("CDN Object Picker:",e))},e.warn=function(e,n){"function"==typeof console.warn&&(void 0!==n?console.warn("CDN Object Picker:",e,n):console.warn("CDN Object Picker:",e))},e.__construct()})()},5:function(e,n,c){}});