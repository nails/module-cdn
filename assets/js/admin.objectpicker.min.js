var _CDN_OBJECTPICKER;_CDN_OBJECTPICKER=function(){var e=this;return e.activePicker=null,e.objectCache=[],e.__construct=function(){return e.log("Constructing"),e.setupListeners(),e.initPickers(),e},e.setupListeners=function(){e.log("Setting up listeners"),$(document).on("click",".cdn-object-picker",function(){return e.openManager($(this)),$(this).trigger("opened"),!1}),$(document).on("click",".cdn-object-picker .cdn-object-picker__remove",function(){return $(this).closest(".cdn-object-picker").trigger("removed"),e.resetPicker($(this).closest(".cdn-object-picker")),!1}),$(document).on("click",".cdn-object-picker .cdn-object-picker__preview-link",function(){return $.fn.fancybox?($(this).closest(".cdn-object-picker").trigger("preview"),$.fancybox.open($(this).attr("href"),{helpers:{overlay:{locked:!1}}})):($(this).closest(".cdn-object-picker").trigger("opened"),e.openManager($(this).closest(".cdn-object-picker"))),!1}),$(document).on("refresh",".cdn-object-picker",function(){return e.refreshPicker($(this)),!1})},e.initPickers=function(){e.log("Processing new CDN Pickers"),e.refreshPicker($(".cdn-object-picker:not(.cdn-object-picker--pending)"))},e.refreshPicker=function(c){var n=[];c.each(function(){$(this).addClass("cdn-object-picker--pending");var e=$(this).find(".cdn-object-picker__input").val();e?n.push(e):$(this).removeClass("cdn-object-picker--pending")}),n.length>0&&$.ajax({url:window.SITE_URL+"api/cdn/object",data:{ids:n.join(","),urls:"150x150-crop"}}).done(function(n){c.each(function(){for(var c=parseInt($(this).find(".cdn-object-picker__input").val(),10),r=n.data.length-1;r>=0;r--)if(c===n.data[r].id)return void e.setPickerObject($(this),n.data[r])}),c.removeClass("cdn-object-picker--pending")}).fail(function(c){var n;try{n=JSON.parse(c.responseText)}catch(r){n={status:500,error:"An unknown error occurred."}}e.warn(n.error)})},e.setPickerObject=function(c,n){if(e.resetPicker(c),e.log("Setting picker object"),c.find(".cdn-object-picker__input").val(n.id),c.trigger("picked"),n.is_img)c.addClass("cdn-object-picker--has-image"),c.find(".cdn-object-picker__preview-link").attr("href",n.url.src),c.find(".cdn-object-picker__preview").css({"background-image":"url("+n.url["150x150-crop"]+")"});else{var r=e.getReadableFileSizeString(n.object.size.bytes);c.addClass("cdn-object-picker--has-file"),c.find(".cdn-object-picker__label").html(n.object.name+" ("+r+")").attr("title",n.object.name+" ("+r+")")}},e.resetPicker=function(c){e.log("Resetting picker"),c.removeClass("cdn-object-picker--has-image cdn-object-picker--has-file"),c.find(".cdn-object-picker__preview-link").attr("href","#"),c.find(".cdn-object-picker__preview").removeAttr("style"),c.find(".cdn-object-picker__label").html(""),c.find(".cdn-object-picker__input").val("")},e.openManager=function(c){c.addClass("cdn-object-picker--pending"),e.log("Getting Manager URL"),$.ajax({url:window.SITE_URL+"api/cdn/manager/url",data:{bucket:c.data("bucket"),callback:["_CDN_OBJECTPICKER","receiveFromManager"]}}).done(function(n){$.fancybox?(e.log("Showing Manager"),e.activePicker=c,$("body").addClass("noscroll"),$.fancybox.open(n.data+"&isModal=1",{type:"iframe",width:"95%",height:"95%",iframe:{preload:!1},helpers:{overlay:{locked:!1}},beforeClose:function(){$("body").removeClass("noscroll")}})):e.warn("Fancybox not enabled.")}).fail(function(c){var n;try{n=JSON.parse(c.responseText)}catch(r){n={status:500,error:"An unknown error occurred."}}e.warn(n.error)}).always(function(){c.removeClass("cdn-object-picker--pending")})},e.receiveFromManager=function(c){e.log("Received data from manager"),e.activePicker.addClass("cdn-object-picker--pending");var n=e.getFromCache(c);n?(e.log("Using Cache"),e.setPickerObject(e.activePicker,n),e.activePicker.removeClass("cdn-object-picker--pending"),e.activePicker=null):(e.log("Requesting Object data"),$.ajax({url:window.SITE_URL+"api/cdn/object",data:{id:c,urls:"150x150-crop"}}).done(function(c){e.setObjectCache(c.data),e.setPickerObject(e.activePicker,c.data)}).fail(function(c){var n;try{n=JSON.parse(c.responseText)}catch(r){n={status:500,error:"An unknown error occurred."}}e.warn(n.error)}).always(function(){e.activePicker.removeClass("cdn-object-picker--pending"),e.activePicker=null}))},e.getReadableFileSizeString=function(e){var c=-1,n=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do e/=1024,c++;while(e>1024);return Math.max(e,.1).toFixed(1)+n[c]},e.getFromCache=function(c){for(var n=e.objectCache.length-1;n>=0;n--)if(e.objectCache[n].id===c)return e.objectCache[n];return null},e.setObjectCache=function(c){e.objectCache.push(c)},e.log=function(e,c){"function"==typeof console.log&&(void 0!==c?console.log("CDN Object Picker:",e,c):console.log("CDN Object Picker:",e))},e.warn=function(e,c){"function"==typeof console.warn&&(void 0!==c?console.warn("CDN Object Picker:",e,c):console.warn("CDN Object Picker:",e))},e.__construct()}();
//# sourceMappingURL=admin.objectpicker.min.js.map
